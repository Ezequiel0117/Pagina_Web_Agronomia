{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mercado Sostenible{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tu hoja de CSS personalizada -->
    <link rel="stylesheet" href="{% static 'style.css' %}">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'forest-green': '#2B601E',
                        'earth-taupe': '#A88D66',
                        'leaf-green': '#91D956',
                        'sky-blue': '#A1C8E8',
                        'golden-harvest': '#D1A24E',
                    }
                }
            }
        }
    </script>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navbar Mejorado -->
    <header class="navbar-blur text-white shadow-2xl sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-5 flex justify-between items-center">
            <div class="logo-animate">
                <a href="/" class="text-3xl font-bold flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    Mercado Sostenible
                </a>
            </div>
            <div class="hidden md:flex space-x-8">
                <a href="#productos-acuicolas" class="text-lg font-semibold text-white hover:text-golden-harvest transition-all duration-300 hover:scale-110">ğŸŸ AcuÃ­colas</a>
                <a href="#productos-pesqueros" class="text-lg font-semibold text-white hover:text-golden-harvest transition-all duration-300 hover:scale-110">ğŸ¦ Pesqueros</a>
                <a href="#productos-ganaderos" class="text-lg font-semibold text-white hover:text-golden-harvest transition-all duration-300 hover:scale-110">ğŸ¥© Ganaderos</a>
                <a href="#productos-vegetales" class="text-lg font-semibold text-white hover:text-golden-harvest transition-all duration-300 hover:scale-110">ğŸ¥¬ Vegetales</a>
            </div>
            <!-- MenÃº hamburguesa para mÃ³viles -->
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-white focus:outline-none icon-shine">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
        </nav>
        
        <!-- MenÃº mÃ³vil -->
        <div id="mobile-menu" class="hidden md:hidden bg-forest-green bg-opacity-95 backdrop-blur-lg">
            <div class="px-6 py-4 space-y-3">
                <a href="#productos-acuicolas" class="block text-lg font-semibold text-white hover:text-golden-harvest transition-colors py-2">ğŸŸ AcuÃ­colas</a>
                <a href="#productos-pesqueros" class="block text-lg font-semibold text-white hover:text-golden-harvest transition-colors py-2">ğŸ¦ Pesqueros</a>
                <a href="#productos-ganaderos" class="block text-lg font-semibold text-white hover:text-golden-harvest transition-colors py-2">ğŸ¥© Ganaderos</a>
                <a href="#productos-vegetales" class="block text-lg font-semibold text-white hover:text-golden-harvest transition-colors py-2">ğŸ¥¬ Vegetales</a>
            </div>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="flex-grow">
        {% block content %}
        {% endblock %}
    </main>

    <!-- Footer Mejorado -->
    <footer class="text-gray-300 py-12 mt-auto">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-bold text-white mb-4">Mercado Sostenible</h3>
                    <p class="text-gray-400">Conectando productores locales con consumidores conscientes. Productos frescos y sostenibles.</p>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-white mb-4">Enlaces RÃ¡pidos</h3>
                    <ul class="space-y-2">
                        <li><a href="#productos-acuicolas" class="text-gray-400 hover:text-white transition-colors">Productos AcuÃ­colas</a></li>
                        <li><a href="#productos-pesqueros" class="text-gray-400 hover:text-white transition-colors">Productos Pesqueros</a></li>
                        <li><a href="#productos-ganaderos" class="text-gray-400 hover:text-white transition-colors">Productos Ganaderos</a></li>
                        <li><a href="#productos-vegetales" class="text-gray-400 hover:text-white transition-colors">Productos Vegetales</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-white mb-4">Contacto</h3>
                    <p class="text-gray-400 mb-2">ğŸ“§ info@mercadosostenible.com</p>
                    <p class="text-gray-400 mb-2">ğŸ“± +593 123 456 789</p>
                    <p class="text-gray-400">ğŸ“ Milagro, Guayas, Ecuador</p>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-6 text-center">
                <p>&copy; 2025 Mercado de ProducciÃ³n Sostenible. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- BotÃ³n del Chatbot Mejorado -->
    <button id="chat-toggle-button" class="fixed bottom-6 right-6 bg-gradient-to-r from-forest-green to-leaf-green text-white p-5 rounded-full shadow-lg hover:from-leaf-green hover:to-forest-green transition-all duration-300 hover:scale-110 focus:outline-none z-40 icon-shine">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
    </button>

    <!-- Ventana del Chatbot Mejorada -->
    <div id="chat-window" class="fixed bottom-24 right-6 w-80 md:w-96 hidden transition-all duration-300 z-50">
        <div class="bg-gradient-to-r from-forest-green to-leaf-green text-white p-5 rounded-t-2xl flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                <h3 class="font-bold text-lg">Asistente Virtual</h3>
            </div>
            <button id="chat-close-button" class="text-white hover:text-gray-200 transition-colors icon-shine">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div id="chat-messages" class="h-80 p-4 overflow-y-auto bg-gradient-to-b from-gray-50 to-white">
            <div class="mb-4 chat-message">
                <div class="bg-gradient-to-r from-sky-blue to-forest-green text-white p-3 rounded-2xl rounded-tl-none max-w-xs shadow-md">
                    Â¡Hola! ğŸ‘‹ Â¿CÃ³mo puedo ayudarte hoy?
                </div>
            </div>
        </div>
        <div class="p-4 bg-white border-t border-gray-200 flex gap-2 rounded-b-2xl">
            <input type="text" id="chat-input" placeholder="Escribe tu mensaje..." class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-forest-green focus:border-transparent transition-all">
            <button id="chat-send-button" class="bg-gradient-to-r from-forest-green to-leaf-green text-white px-5 py-3 rounded-xl font-bold hover:from-leaf-green hover:to-forest-green transition-all duration-300 btn-modern shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Script del Chatbot Mejorado -->
    <script>
document.addEventListener('DOMContentLoaded', () => {
    // Toggle del menÃº mÃ³vil
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    if (mobileMenuButton) {
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    }

    // Chatbot
    const chatToggleButton = document.getElementById('chat-toggle-button');
    const chatWindow = document.getElementById('chat-window');
    const chatCloseButton = document.getElementById('chat-close-button');
    const chatSendButton = document.getElementById('chat-send-button');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');

    let currentContext = 'main_menu'; // Para saber en quÃ© parte del menÃº estamos

    chatToggleButton.addEventListener('click', () => {
        chatWindow.classList.toggle('hidden');
        chatToggleButton.classList.toggle('hidden');
        if (!chatWindow.classList.contains('hidden')) {
            // Si el chat se abre, asegÃºrate de que el menÃº principal se muestre
            displayMainMenu();
        }
    });

    chatCloseButton.addEventListener('click', () => {
        chatWindow.classList.add('hidden');
        chatToggleButton.classList.remove('hidden');
    });

    const addMessage = (text, isUser = false, emoji = '') => {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('mb-4', 'chat-message');

        if (isUser) {
            messageDiv.classList.add('flex', 'justify-end', 'user-message');
            messageDiv.innerHTML = `<div class="bg-gradient-to-r from-gray-600 to-gray-700 text-white p-3 rounded-2xl rounded-tr-none max-w-xs shadow-md">${text}</div>`;
        } else {
            messageDiv.innerHTML = `<div class="bg-gradient-to-r from-sky-500 to-teal-500 text-white p-3 rounded-2xl rounded-tl-none max-w-xs shadow-md">${emoji} ${text}</div>`;
        }
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    };

    const sendMessage = () => {
        const messageText = chatInput.value.trim();
        if (messageText === '') return;

        addMessage(messageText, true); // Mostrar mensaje del usuario
        chatInput.value = '';

        // Indicador de escritura
        const typingDiv = document.createElement('div');
        typingDiv.classList.add('mb-4', 'chat-message');
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `<div class="bg-gray-200 p-3 rounded-2xl rounded-tl-none max-w-xs"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        setTimeout(() => {
            document.getElementById('typing-indicator').remove();
            handleBotResponse(messageText);
        }, 1000);
    };

    chatSendButton.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    const displayMainMenu = () => {
        currentContext = 'main_menu';
        // Mostrar el menÃº como un Ãºnico mensaje con saltos de lÃ­nea HTML
        const welcomeMessage = `
            Â¡Hola! ğŸ‘‹ Soy tu asistente. Â¿CÃ³mo puedo ayudarte hoy?<br>
            Por favor, elige una opciÃ³n:<br><br>
            1. InformaciÃ³n sobre Productos AcuÃ­colas ğŸŸ<br>
            2. InformaciÃ³n sobre Productos Pesqueros ğŸ¦<br>
            3. InformaciÃ³n sobre Productos Ganaderos ğŸ¥©<br>
            4. InformaciÃ³n sobre Productos Vegetales ğŸ¥¬<br>
            5. Preguntas Frecuentes (FAQ) â“<br>
            6. Contacto y Horarios ğŸ“<br>
            7. Volver al menÃº principal ğŸ 
        `;
        addMessage(welcomeMessage);
    };

    const displayFAQMenu = () => {
        currentContext = 'faq_menu';
        const faqMessage = `
            Preguntas Frecuentes. Elige una opciÃ³n:<br>
            1. Â¿CuÃ¡les son los precios promedio? ğŸ’°<br>
            2. Â¿Ofrecen envÃ­o a domicilio? ğŸšš<br>
            3. Â¿Son productos sostenibles/ecolÃ³gicos? ğŸŒ±<br>
            4. Â¿DÃ³nde estÃ¡n ubicados? ğŸ“<br>
            5. Volver al menÃº principal ğŸ 
        `;
        addMessage(faqMessage);
    };

    const handleBotResponse = (userMessage) => {
        const choice = parseInt(userMessage.trim());

        let botReply = "OpciÃ³n no vÃ¡lida. Por favor, elige un nÃºmero de las opciones disponibles.";
        let emoji = "ğŸ¤”";

        if (currentContext === 'main_menu') {
            switch (choice) {
                case 1:
                    botReply = "Nuestros productos acuÃ­colas, como la tilapia y camarones, son frescos y criados en sistemas controlados. Precio: $12.50 / kg.";
                    emoji = "ğŸŸ";
                    break;
                case 2:
                    botReply = "Ofrecemos una selecciÃ³n de pescado y marisco fresco, capturado de forma responsable por pescadores locales. Precio: $18.00 / kg.";
                    emoji = "ğŸ¦";
                    break;
                case 3:
                    botReply = "Nuestros productos ganaderos incluyen carne de res, pollo, cerdo y lÃ¡cteos de ganado criado Ã©ticamente en pastizales. Precio: $9.75 / kg.";
                    emoji = "ğŸ¥©";
                    break;
                case 4:
                    botReply = "Disponemos de frutas y verduras frescas de temporada, cultivadas localmente sin pesticidas daÃ±inos. Precio: $3.50 / kg.";
                    emoji = "ğŸ¥¬";
                    break;
                case 5:
                    displayFAQMenu(); // Cambia al menÃº de FAQ
                    return; // No aÃ±ades la respuesta de botReply aquÃ­, ya la maneja displayFAQMenu
                case 6:
                    botReply = "Puedes contactarnos al +593 123 456 789 o por email en contacto@mercadosostenible.ec. Estamos abiertos de lunes a sÃ¡bado, de 8:00 AM a 6:00 PM.";
                    emoji = "ğŸ“";
                    break;
                case 7:
                    displayMainMenu(); // Reinicia el menÃº principal
                    return;
                default:
                    botReply = "OpciÃ³n no vÃ¡lida. Por favor, elige un nÃºmero del 1 al 7 para el menÃº principal.";
                    emoji = "âŒ";
            }
        } else if (currentContext === 'faq_menu') {
            switch (choice) {
                case 1:
                    botReply = "Nuestros precios promedio son: AcuÃ­colas ($12.50/kg), Pesqueros ($18.00/kg), Ganaderos ($9.75/kg) y Vegetales ($3.50/kg).";
                    emoji = "ğŸ’°";
                    break;
                case 2:
                    botReply = "SÃ­, ofrecemos servicio de envÃ­o local gratuito para compras superiores a $50.";
                    emoji = "ğŸšš";
                    break;
                case 3:
                    botReply = "SÃ­, nos enorgullece ofrecer productos sostenibles y ecolÃ³gicos de productores locales.";
                    emoji = "ğŸŒ±";
                    break;
                case 4:
                    botReply = "Estamos ubicados en Milagro, Guayas, Ecuador. Â¡Esperamos tu visita!";
                    emoji = "ğŸ“";
                    break;
                case 5:
                    displayMainMenu(); // Volver al menÃº principal
                    return;
                default:
                    botReply = "OpciÃ³n no vÃ¡lida. Por favor, elige un nÃºmero del 1 al 5 para las Preguntas Frecuentes.";
                    emoji = "âŒ";
            }
        }

        addMessage(botReply, false, emoji);
        // DespuÃ©s de una respuesta, siempre regresa al menÃº principal (o al contexto anterior)
        if (currentContext !== 'main_menu' && currentContext !== 'faq_menu') { // Si no estamos ya en un menÃº, lo mostramos
             // Si no es un submenÃº que requiere seguir ahÃ­, mostramos el menÃº principal despuÃ©s de la respuesta
             setTimeout(displayMainMenu, 1500); // Dar tiempo para leer la respuesta
        } else if (currentContext === 'faq_menu' && choice !== 5) { // Si estamos en FAQ y no pidiÃ³ volver
             setTimeout(displayFAQMenu, 1500);
        } else if (currentContext === 'main_menu' && choice !== 7) { // Si estamos en Main y no pidiÃ³ volver
             setTimeout(displayMainMenu, 1500);
        }
    };

    // Mensaje de bienvenida inicial del bot al cargar o abrir el chat
    // AsegÃºrate de que este sea el primer mensaje si el chat estÃ¡ oculto por defecto
    if (chatWindow.classList.contains('hidden')) {
        // No hacer nada, se mostrarÃ¡ al abrir
    } else {
        displayMainMenu();
    }
});
    </script>

</body>
</html>